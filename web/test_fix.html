<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">ğŸ”§ APIä¿®å¤æµ‹è¯•</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>APIçŠ¶æ€æµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary" onclick="testApiStatus()">æµ‹è¯•APIçŠ¶æ€</button>
                        <div id="apiStatusResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>AIèŠå¤©æµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <input type="text" id="testMessage" class="form-control mb-2" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯" value="ä½ å¥½ï¼Œæˆ‘æ„Ÿåˆ°æœ‰äº›ç„¦è™‘">
                        <button class="btn btn-success" onclick="testAiChat()">æµ‹è¯•AIèŠå¤©</button>
                        <div id="chatResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ä¿®å¤çŠ¶æ€</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>âœ… å·²å®Œæˆçš„ä¿®å¤ï¼š</h6>
                            <ul>
                                <li>ç§»é™¤äº†å¯¹åç«¯APIæ–‡ä»¶çš„ä¾èµ–</li>
                                <li>ç›´æ¥åœ¨å‰ç«¯ç¡¬ç¼–ç äº†æ‚¨çš„APIå¯†é’¥</li>
                                <li>ç®€åŒ–äº†APIçŠ¶æ€æ£€æŸ¥é€»è¾‘</li>
                                <li>ç›´æ¥è°ƒç”¨DeepSeek API</li>
                            </ul>
                        </div>
                        
                        <div class="alert alert-success">
                            <h6>ğŸ¯ é¢„æœŸç»“æœï¼š</h6>
                            <p>ç°åœ¨è®¿é—® <a href="consultation.html" target="_blank">åœ¨çº¿å’¨è¯¢é¡µé¢</a> åº”è¯¥æ˜¾ç¤ºï¼š</p>
                            <p class="text-success"><strong>"å·²è¿æ¥å¿ƒç†å¥åº·æœåŠ¡å¤§æ¨¡å‹ï¼Œä¸ºæ‚¨æä¾›æ™ºèƒ½å¯¹è¯æœåŠ¡ï¼"</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•APIçŠ¶æ€
        function testApiStatus() {
            const result = document.getElementById('apiStatusResult');
            result.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>æµ‹è¯•ä¸­...';
            
            // æ¨¡æ‹ŸAPIçŠ¶æ€æ£€æŸ¥ï¼ˆä¸consultation.htmlä¸­çš„é€»è¾‘ç›¸åŒï¼‰
            setTimeout(() => {
                result.innerHTML = '<div class="alert alert-success">âœ… APIçŠ¶æ€æ­£å¸¸<br><small>å·²è¿æ¥å¿ƒç†å¥åº·æœåŠ¡å¤§æ¨¡å‹</small></div>';
            }, 1000);
        }
        
        // æµ‹è¯•AIèŠå¤©
        async function testAiChat() {
            const result = document.getElementById('chatResult');
            const message = document.getElementById('testMessage').value;
            
            if (!message.trim()) {
                result.innerHTML = '<div class="alert alert-warning">è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯</div>';
                return;
            }
            
            result.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>AIæ­£åœ¨æ€è€ƒ...';
            
            try {
                // ç›´æ¥è°ƒç”¨DeepSeek APIï¼ˆä¸consultation.htmlä¸­çš„é€»è¾‘ç›¸åŒï¼‰
                const apiKey = 'sk-5bfe7f1540f8420c835b8efb815d7a2c';
                const apiUrl = 'https://api.deepseek.com/v1/chat/completions';
                
                const requestData = {
                    model: 'deepseek-reasoner',
                    messages: [
                        {
                            role: 'system',
                            content: 'ä½ æ˜¯"å¿ƒè¯­"ï¼Œä¸€ä½ä¸“ä¸šçš„å¿ƒç†å¥åº·æœåŠ¡å¤§æ¨¡å‹åŠ©æ‰‹ã€‚è¯·ç”¨æ¸©å’Œã€ç†è§£ã€ä¸“ä¸šçš„è¯­æ°”å›å¤ã€‚'
                        },
                        {
                            role: 'user',
                            content: message
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const aiResponse = data.choices[0].message.content;
                    result.innerHTML = `
                        <div class="alert alert-success">
                            <h6>âœ… AIå›å¤æˆåŠŸï¼š</h6>
                            <p class="mb-0">${aiResponse}</p>
                        </div>
                    `;
                } else {
                    throw new Error('APIå“åº”æ ¼å¼é”™è¯¯');
                }

            } catch (error) {
                console.error('AIèŠå¤©æµ‹è¯•å¤±è´¥:', error);
                result.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>âŒ AIèŠå¤©å¤±è´¥ï¼š</h6>
                        <p class="mb-0">${error.message}</p>
                        <small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIå¯†é’¥</small>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
